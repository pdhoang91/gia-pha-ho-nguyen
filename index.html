<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Gia Phả Họ Nguyễn</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-bottom: 20px;
      text-align: center;
    }

    .link {
      fill: none;
      stroke: #ccc;
      stroke-width: 2px;
    }

    .info-text {
      font: 12px sans-serif;
      fill: black;
    }

    /* CSS cho modal */
    #imageModal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.8);
    }

    #modalContent {
      max-width: 800px;
      margin: 50px auto;
      background-color: #333;
      padding: 20px;
      border-radius: 10px;
    }

    #parentInfo {
      display: flex;
    }

    #modalImage {
      width: 300px;
      height: 400px;
      border-radius: 10px;
      object-fit: cover;
    }

    #modalInfo {
      color: #fff;
      margin-left: 20px;
      flex: 1;
      overflow-y: auto;
    }

    #modalInfo h2 {
      margin-bottom: 10px;
    }

    #modalInfo p {
      margin: 5px 0;
    }

    #childrenSection {
      margin-top: 20px;
    }

    #childrenSection h3 {
      color: #fff;
    }

    #childrenImages {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .child-image {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      cursor: pointer;
    }

    #closeModal {
      position: absolute;
      top: 20px;
      right: 35px;
      color: #fff;
      font-size: 40px;
      font-weight: bold;
      cursor: pointer;
    }

    #closeModal:hover {
      color: #bbb;
    }

    /* CSS cho nút zoom */
    #zoomControls {
      position: fixed;
      top: 20px;
      right: 20px;
    }

    #zoomControls button {
      display: block;
      margin-bottom: 5px;
    }

    /* CSS cho nút mở rộng/thu gọn */
    .node-button {
      cursor: pointer;
    }

    .node-button-text {
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>Gia Phả Họ Nguyễn</h1>
    <div id="svgContainer">
      <svg width="960" height="600"></svg>
    </div>
  </div>

  <!-- Nút điều khiển zoom -->
  <div id="zoomControls">
    <button id="zoomIn">Phóng to</button>
    <button id="zoomOut">Thu nhỏ</button>
    <button id="resetZoom">Đặt lại</button>
  </div>

  <!-- Modal để hiển thị hình ảnh phóng to và thông tin -->
  <div id="imageModal">
    <span id="closeModal">&times;</span>
    <div id="modalContent">
      <div id="parentInfo">
        <img id="modalImage">
        <div id="modalInfo">
          <h2 id="modalName"></h2>
          <p id="modalDescription"></p>
          <p><strong>Số điện thoại:</strong> <span id="modalPhone"></span></p>
          <p><strong>Địa chỉ:</strong> <span id="modalAddress"></span></p>
        </div>
      </div>
      <div id="childrenSection">
        <h3>Con cái:</h3>
        <div id="childrenImages"></div>
      </div>
    </div>
  </div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    // Dữ liệu cây gia phả (dữ liệu mẫu)
     // Dữ liệu cây gia phả (cập nhật nếu cần)
     const treeData = {
      "name": "Chồng Nguyễn Văn Hoành",
      "dob": "01-01-1945",
      "spouse": "Vợ Trần Thị Nhiệm",
      "image": "images/tranthinhiem.jpg",
      "phone": "0123456789",
      "address": "Thanh Hoá, Việt Nam",
      "description": "Ông và bà là người sáng lập gia đình. Ông Nguyễn Văn Hoành sinh năm 2019 mất ngày 05/06/1998 âm lịch. Bà Trần Thị Nhiệm sinh năm 1923, mất ngày 14/12/2014 âm lịch",
      "children": [
      {
          "name": "Con gái Nguyễn Thị Thiệm",
          "spouse": "Con rể Lê Cảnh Bin",
          "image": "https://via.placeholder.com/50",
          "description": "Hiện đang sinh sống và làm việc tại Đồng Nai",
          "phone": "0966274586(con trai)",
          "address": "Xuân Quế, Cẩm Mỹ, Đồng Nai, Việt Nam",
          "children": [
            {
              "name": "Cháu trai Lê Cảnh Bản",
              "spouse": "Cháu dâu Lâm Thị Vinh 23/03/1982",
              "image": "images/nguyenthithiem/lecanhban.jpg",
              "phone": "0966274586",
              "address": "Thanh Hoá, Việt Nam",
              "description": "",
              "children": [
                {
                  "name": "Cháu gái Lê Ngọc Anh",
                  "spouse": "",
                  "image": "images/nguyenthithiem/lengocanh.jpg",
                  "description": "01/09/2003"
                },
                {
                  "name": "Cháu gái Lê Tuấn Anh",
                  "spouse": "",
                  "image": "images/nguyenthithiem/lengocanh.jpg",
                  "description": "27/11/2004"
                }
              ]
             
            },
            {
              "name": "Cháu gái Lê Thị Hội 05/10/1972",
              "spouse": "Cháu rể Võ Văn Lành 1973",
              "image": "images/nguyenthithiem/lethihoi.jpg",
              "phone": "0989354675",
               "address": "Xuân Quế, Cẩm Mỹ, Đồng Nai, Việt Nam",
               "description": "",
              "children": [
                {
                  "name": "Chắt Võ Văn Anh Phương",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Xuân Quế, Cẩm Mỹ, Đồng Nai, Việt Nam",
                  "description": "2001"
                },
                {
                  "name": "Chắt 2 Võ Văn Bình",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Xuân Quế, Cẩm Mỹ, Đồng Nai, Việt Nam",
                  "description": "2022"
                }
              ]
             
            },
            {
              "name": "Cháu trai Lê Cảnh Trường",
              "spouse": "Cháu dâu Vũ Thị Ngọc Diễm",
              "image": "images/nguyenthithiem/lecanhtruong.jpg",
              "phone": "",
              "address": "Xuân Quế, Cẩm Mỹ, Đồng Nai, Việt Nam",
              "description": "Lê Cảnh Trường 30/10/1974. Vũ Thị Ngọc Diễm 1/07/1977",
              "children": [
                {
                  "name": "Chắ 1 Lê Cảnh Thọ",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Xuân Quế, Cẩm Mỹ, Đồng Nai, Việt Nam",
                  "description": "Lê Cảnh Thọ 1993"
                },
                {
                  "name": "Chắt Lê Ngọc Ánh",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Xuân Quế, Cẩm Mỹ, Đồng Nai, Việt Nam",
                  "description": "Lê Ngọc Ánh sinh năm 27/01/2004"
                },
                {
                  "name": "Chắt Lê Cảnh Sơn",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Xuân Quế, Cẩm Mỹ, Đồng Nai, Việt Nam",
                  "description": "Lê Cảnh Sơn sinh năm 27/04/2007 mất 23/05/2014"
                },
              ]
             
            }
          ]
        },
        {
          "name": "Con gái Nguyễn Thị Diện",
          "spouse": "Con rể Trần Đình Ngọc",
          "image": "images/nguyenthidien/nguyenthidien.jpg",
          "description": "Hiện đang sinh sống và làm việc tại quê nhà Triệu Sơn - Thanh Hoá",
          "children": [
          {
              "name": "Cháu gái Trần Thị Hồng",
              "spouse": "Cháu rể Bang",
              "image": "images/nguyenthidien/tranthịhong.jpg",
              "children": [
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                }
              ]
            },
            {
              "name": "Cháu trai Trần Đình Hiếu",
              "spouse": "Cháu dâu Huệ",
              "image": "images/nguyenthidien/trandinhhieu.jpg",
              "children": [
                {
                  "name": "Chắt trai Trần Đình Hải Âu",
                  "spouse": "",
                  "image": "images/nguyenthidien/trandinhhieu/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt trai Trần Đình Huy",
                  "spouse": "",
                  "image": "images/nguyenthidien/trandinhhieu/2.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                }
              ]
            },
            {
              "name": "Cháu gái Trần Thị Hoa",
              "spouse": "Cháu rể Tấn",
              "image": "images/nguyenthidien/tranthịhoa.jpg",
              "children": [
                {
                  "name": "Chắt 1 Đạt",
                  "spouse": "",
                  "image": "images/nguyenthidien/tranthịhoa/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt 1 Trân",
                  "spouse": "",
                  "image": "images/nguyenthidien/tranthịhoa/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                }
              ]
            },
            {
              "name": "Cháu trai Trần Đình Hùng",
              "spouse": "Cháu dâu ...",
              "image": "images/nguyenthidien/trandinhhung.jpg",
              "children": [
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt 2",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt 3",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt 4",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
              ]
            }
            
           
          ]
         
        },
        {
          "name": "Con gái Nguyễn Thị Khách",
          "spouse": "Con rể Thoa",
          "image": "https://via.placeholder.com/50",
          "description": "Hiện đang sinh sống và làm việc tại quê nhà Triệu Sơn - Thanh Hoá",
          "phone": "0123456789",
                    "address": "Thanh Hoá, Việt Nam",
          "children": [
            {
              "name": "Cháu trai Thông",
              "spouse": "Cháu dâu ...",
              "image": "images/nguyenthikhach/thong.jpg",
              "children": [
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                }
              ]
            },
            {
              "name": "Cháu gái Thường",
              "spouse": "Cháu rể ...",
              "image": "images/nguyenthikhach/thuong.jpg",
              "children": [
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                }
              ]
            },
            {
              "name": "Cháu trai Xuyên",
              "spouse": "Cháu dâu ...",
              "image": "images/nguyenthikhach/xuyen.jpg",
              "children": [
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                }
              ]
            },
            {
              "name": "Cháu gái Dung",
              "spouse": "Cháu dâu ...",
              "image": "images/nguyenthikhach/xuyen.jpg",
              "children": [
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                }
              ]
            },
          ]
        },
      {
          "name": "Con trai Nguyễn Ngọc Hân",
          "spouse": "Con dâu Vũ Thị Ân",
          "image": "images/nguyenngochan/nguyenngochan.jpg",
          "description": "Mất 02/05/2022 âm lich",
          "description": "Nguyễn Ngọc Hân sinh ngày 1952, mất ngày 02/05/2022 âm lich. Bà Vũ Thị Ân sinh ngày 08/10/1955",
          "children": [
            {
              "name": "Cháu gái Nguyễn Thị Oanh",
              "spouse": "Cháu rể Lê Trung",
              "image": "images/nguyenngochan/nguyenthioanh.jpg",
              "description": "Đang công tác tại bệnh viện nhi Thanh Hoá",
              "phone": "0123456789",
              "address": "Thanh Hoá, Việt Nam",
              "children": [
                  {
                    "name": "Lê Trung Hiếu",
                    "spouse": "",
                    "image": "images/nguyenngochan/nguyenthioanh/1.jpg",
                    "description": "Sinh năm 2007",
                    "phone": "0123456789",
                    "address": "Thanh Hoá, Việt Nam",
                  },
                  {
                    "name": "Chắt gái Lê Như Quỳnh Bông",
                    "spouse": "",
                    "image": "images/nguyenngochan/nguyenthioanh/2.jpg",
                    "description": "Sinh năm 2011",
                  }
                ]
            },
           
            {
              "name": "Cháu gái Nguyễn Thị Yến",
              "spouse": "Cháu rể Đồng",
              "image": "images/nguyenngochan/nguyenthiyen.jpg",
              "phone": "0123456789",
                    "address": "Thanh Hoá, Việt Nam",
              "children": [
                {
                  "name": "Chắt 1 Bùi Văn Minh",
                  "spouse": "",
                  "image": "images/nguyenngochan/nguyenthiyen/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt Bùi Mai Trang",
                  "spouse": "",
                  "image": "images/nguyenngochan/nguyenthiyen/2.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                }
              ]
              
            },
            {
              "name": "Cháu gái Nguyễn Thị Ưng",
              "spouse": "Cháu rể Khánh",
              "image": "images/nguyenngochan/nguyenthiung.jpg",
              "description": "Bao nhieu tuổi 0859666683, đang học ở đâu.",
              "phone": "0123456789",
                    "address": "Thanh Hoá, Việt Nam",
              "children": [
                {
                  "name": "Chắt 1 Nguyễn Khánh Linh",
                  "spouse": "",
                  "image": "images/nguyenngochan/nguyenthiung/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi 2009, đang học ở đâu."
                },
                {
                  "name": "Chắt 2 Nguyễn Quang Anh",
                  "spouse": "",
                  "image": "images/nguyenngochan/nguyenthiung/2.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi 2014, đang học ở đâu., 2014"
                }
              ]
              
            },
            {
              "name": "Cháu trai Nguyễn Văn Tuấn",
              "spouse": "Cháu dâu Tâm",
              "image": "images/nguyenngochan/nguyenvantuan.jpg",
              "description": "Đang công tác tại phó bí thư xã An Nông - Triệu Sơn, Thanh Hoá",
              "children": [
                  {
                    "name": "Cháu trai Nguyễn Tuấn Hùng(Xu)",
                    "spouse": "",
                    "image": "images/nguyenngochan/nguyenvantuan/1.jpg",
                    "description": "sinh năm 2014",
                    "phone": "0123456789",
                    "address": "Thanh Hoá, Việt Nam",
                  },
                  {
                    "name": "Nguyễn Ngọc Anh",
                    "spouse": "",
                    "image": "images/nguyenngochan/nguyenvantuan/2.jpg",
                    "description": "sinh năm 2021",
                    "phone": "0123456789",
                    "address": "Thanh Hoá, Việt Nam",
                  }
                ]
            },
            {
              "name": "Cháu gái Nguyễn Thị Ánh",
              "spouse": "Cháu rể ...",
              "image": "images/nguyenngochan/nguyenthianh.jpg",
              "phone": "0123456789",
                    "address": "Thanh Hoá, Việt Nam",
              "children": [
                {
                  "name": "Chắt 1 Nguyễn THảo My",
                  "spouse": "",
                  "image": "images/nguyenngochan/nguyenthianh/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổ 2011, đang học ở đâu."
                },
                {
                  "name": "Chắt 1 Nguyễn Mai Lan",
                  "spouse": "",
                  "image": "images/nguyenngochan/nguyenthianh/2.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi 2016, đang học ở đâu."
                }
              ]
              
            },
            {
              "name": "Cháu trai Nguyễn Tiến Thành",
              "spouse": "Cháu dâu ...",
              "image": "images/nguyenngochan/nguyentienthanh.jpg",
              "description": "Bao nhieu tuổi, đang học ở đâu.",
              "phone": "0123456789",
                    "address": "Thanh Hoá, Việt Nam",
              "children": [
                {
                  "name": "Chắt 1 Nguyễn Mai Hương",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi 2016, đang học ở đâu."
                },
                {
                  "name": "Chắt 2 Nguyễn Trâm Anh",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi 2019, đang học ở đâu."
                },
                {
                  "name": "Chắt 3 Nguyễn Thành An",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi 2021, đang học ở đâu."
                },
              ]
              
            }
          ]
        },
        {
          "name": "Con gái Nguyễn Thị Hoan",
          "spouse": "Con rể Thắng",
          "image": "images/1.jpg",
          "description": "Hiện tại đang buôn bán ve chai",
          "children": [
          {
              "name": "Cháu gái Hoàng Thị Vân",
              "spouse": "Cháu rể ..",
              "image": "images/nguyenthihoan/hoangthivan.jpg",
              "children": [
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                }
              ]
            },
            {
              "name": "Cháu gái Hoàng Thị Minh",
              "spouse": "Cháu rể ..",
              "image": "images/nguyenthihoan/hoangthiminh.jpg",
              "children": [
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                }
              ]
            },
            {
              "name": "Cháu trai Hoàng Văn Thai",
              "spouse": "Cháu dâu ..",
              "image": "images/nguyenthihoan/hoangvanthai.jpg",
              "children": [
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                }
              ]
            },
            {
              "name": "Cháu trai Hoàng Văn Thanh",
              "spouse": "Cháu dâu ..",
              "image": "images/nguyenthihoan/hoangvanthanh.jpg",
              "children": [
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt 1",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                }
              ]
            }
            
          ]
        },
        {
          "name": "Con trai Nguyễn Thanh Hằng",
          "spouse": "Con dâu Thị Bình",
          "image": "images/nguyenthanhhang/nguyenthanhhang.jpg",
          "description": "Nguyễn Thanh Hằng sinh năm 03/10/1960 bà Nguyễn Thị Bình 05/12/1959",
          "phone": "0123456789",
          "address": "Suối mơ, Đồng Nai, Việt Nam",
          "children": [
            {
              "name": "Cháu trai Nguyễn Du",
              "spouse": "Cháu dâu Lê Thị Thắm",
              "image": "images/nguyenthanhhang/nguyendu.jpg",
              "description": "Đang công tác tại phó phòng Phòng Cháy Chữa Cháy tỉnh Biên Hoà",
              "phone": "0123456789",
               "address": "Thanh Hoá, Việt Nam",
              "children": [
                {
                  "name": "Chắt trai Nguyễn Minh Đức",
                  "spouse": "",
                  "image": "images/nguyenthanhhang/nguyenminhduc.jpg",
                  "description": "Sinh 2014",
                },
                {
                  "name": "Chắt trai Nguyễn Đức Anh",
                  "spouse": "",
                  "image": "images/nguyenthanhhang/nguyenminhduc.jpg",
                
                }
              ]
            },
            {
              "name": "Cháu trai Nguyễn Văn Dương",
              "spouse": "Cháu dâu ...",
              "image": "images/nguyenthanhhang/nguyenvanduong.jpg",
              "phone": "0123456789",
               "address": "Thanh Hoá, Việt Nam",
              "children": [
                {
                  "name": "Chắt trai Nguyễn Tiến Minh",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt gái Nguyễn Trà My",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                }
              ]
            },
            {
              "name": "Cháu gái Nguyễn Văn Vương",
              "spouse": "Cháu dâu Nguyễn Thị Bích Trâm",
              "image": "images/nguyenthanhhang/nguyenvanvuong.jpg",
              "description": "SĐT cháu Vương: 00865396279",
              "phone": "0123456789",
              "address": "Thanh Hoá, Việt Nam",
              "description": "Nguyễn Văn Vương 1987. Nguyễn Thị Bích Trâm 1992",
              "children": [
                {
                  "name": "Chắt gái Nguyễn Ngọc Thanh Trúc",
                  "spouse": "",
                  "image": "images/nguyenthanhhang/nguyenvanvuong/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi sinh năm 2013, đang học ở đâu."
                },
                {
                  "name": "Chắt gái Nguyễn Ngọc Trúc My",
                  "spouse": "",
                  "image": "images/nguyenthanhhang/nguyenvanvuong/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi sinh 2019, đang học ở đâu."
                },
                {
                  "name": "Chắt gái Nguyễn Ngọc Tường Vy",
                  "spouse": "",
                  "image": "images/nguyenthanhhang/nguyenvanvuong/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, sinh năm 2023, đang học ở đâu."
                }
              ]
            },
            {
              "name": "Cháu gái Nguyễn Thị Hương",
              "spouse": "Cháu dâu ...",
              "image": "images/nguyenthanhhang/nguyenthihuong.jpg",
              "phone": "0123456789",
              "address": "Thanh Hoá, Việt Nam",
              "children": [
                {
                  "name": "Chắt trai Hoàng Thiên Khánh",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi 2014, đang học ở đâu."
                }
              ]
            }
          ]
        },
        {
          "name": "Con trai Nguyễn Ngọc Cơ",
          "spouse": "Con dâu Trần Thị Nên",
          "image": "images/nguyenngocco/nguyenngocco.jpg",
          "description": "Hiện đang sinh sống và làm việc tại Hà Nội",
          "phone": "0979479479",
          "address": "Thanh Hoá, Việt Nam",
          "description": "Nguyễn Ngọc Cơ ngày sính 1962, Trần Thị Nên 1965",
          "children": [
            {
              "name": "Cháu gái Nguyễn Việt Hà",
              "spouse": "Cháu rể Thái",
              "image": "images/nguyenngocco/nguyenvietha.jpg",
              "description": "Nguyễn Việt Hà 10/04/1992",
              "children": [
                {
                  "name": "Chắt gái Nguyễn Minh Châu",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Nguyễn Minh Châu 02/05/2019"
                },
                {
                  "name": "Chắt trai Nguyễn Bá Minh",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Nguyễn Bá Minh 11/08/2022"
                }
              ]
            },
            {
              "name": "Cháu trai Nguyễn Việt Anh",
              "spouse": "Cháu dâu Hà Thị Giang",
              "image": "images/nguyenngocco/nguyenvietanh.jpg",
              "description": "Nguyễn Việt Anh 17/10/1997",
              "children": [
                {
                  "name": "Chắt 1 Nguyễn Anh Tú",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Nguyễn Anh Tú 20/02/2024"
                }
              ]
             
            }
          ]
        },
        {
          "name": "Con trai Nguyễn Văn Sở",
          "spouse": "Con dâu Nguyễn Thị Thạch",
          "image": "images/nguyenvanso/nguyenvanso.jpg",
          "description": "Nguyễn Văn Sở Sinh năm 1962, Bà Nguyễn Thị Thạch 1962",
          "phone": "0329245277",
           "address": "Thanh Hoá, Việt Nam",
          "children": [
            {
              "name": "Cháu trai Nguyễn Văn Sơn",
              "spouse": "Cháu dâu Hoàng Thị Huyền 20/04/2000",
              "image": "images/nguyenvanso/nguyenvanson.jpg",
              "description": "Nguyễn Văn Sơn 1993, Hoàng Thị Huyền 20/04/2000"
            },
            {
              "name": "Cháu gái Nguyễn Thị Ngân",
              "spouse": "Cháu rể Đỗ Đức Lâm",
              "image": "images/nguyenvanso/nguyenthingan.jpg",
              "children": [
                {
                  "name": "Chắt Đỗ Minh Khôi",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "12/03/2024"
                }
              ]
            }
          ]
        },
        {
          "name": "Con trai Nguyễn Văn Mạnh",
          "spouse": "Con dâu Nguyễn Thị Ngoan",
          "image": "images/nguyenvanmanh/nguyenvanmanh.jpg",
          "description": "Sinh ngày 1966, Ngày mất 17/11/2017 âm lịch. Và Nguyễn Thị Ngoan sinh năm 1965",
          "phone": "0123456789",
          "address": "Thanh Hoá, Việt Nam",
          "children": [
            {
              "name": "Cháu trai Nguyễn Văn Dũng",
              "spouse": "Cháu dâu Ly",
              "image": "images/nguyenvanmanh/nguyenvandung.jpg",
                "children": [
                  {
                    "name": "Chắt gái Nguyễn Trà My",
                    "spouse": "",
                    "image": "images/nguyenvanmanh/nguyenvandung.jpg",
                    "description": "Sinh năm 21/07/2012 dương lịch"
                  },
                  {
                    "name": "Chắt gái Nguyễn Hà Vy",
                    "spouse": "",
                    "image": "images/nguyenvanmanh/nguyenvandung.jpg",
                    "description": "Sinh năm 19/01/2018 dương lịch"
                  },
                  {
                    "name": "Chắt trai Nguyễn Trường An",
                    "spouse": "",
                    "image": "images/nguyenvanmanh/nguyenvandung.jpg",
                    "description": "Sinh năm 19/09/2019 dương lịch"
                  }
                ]
            },
            {
              "name": "Cháu trai Nguyễn Ngọc Quý",
              "spouse": "Cháu dâu Hoàng Thị Tuyết",
              "image": "images/nguyenvanmanh/nguyenngocquy.jpg",
              "phone": "0123456789",
               "address": "Thanh Hoá, Việt Nam",
               "description": "Nguyễn Ngọc Quý 1/008/1990. Hoàng Thị Tuyết 1990",
              "children": [
                {
                  "name": "Chắt trai Nguyễn Gia Bảo",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Sinh năm 2011"
                },
                {
                  "name": "Chắt trai Nguyễn Bảo Khanh",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "2015"
                },
                {
                  "name": "Chắt trai Chuối",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "2023"
                }
              ]
             
            },
            {
              "name": "Cháu gái Nguyễn Thị Lan",
              "spouse": "Cháu rể ...",
              "image": "images/nguyenvanmanh/nguyenthilan.jpg",
              "phone": "0123456789",
               "address": "Thanh Hoá, Việt Nam",
              "children": [
                {
                  "name": "Chắt gái Hoàng Linh Nhi",
                  "spouse": "",
                  "image": "images/1.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                },
                {
                  "name": "Chắt trai Bon",
                  "spouse": "",
                  "image": "images/2.jpg",
                  "phone": "",
                  "address": "Thanh Hoá, Việt Nam",
                  "description": "Bao nhieu tuổi, đang học ở đâu."
                }
              ]
             
            }
          ]
        },
        {
          "name": "Con gái Nguyễn Thị Toan",
          "spouse": "Con rể Phạm Đình Hiến",
          "image": "images/nguyenthitoan/nguyenthitoan.jpg",
          "phone": "0987654321",
          "address": "Hồ Chí Minh, Việt Nam",
          "description": "Nguyễn Thị Toan 06/10/1972. Phạm Đình Hiến(đã mất)",
          "children": [
            {
              "name": "Cháu trai Phạm Đình Hoàng",
              "spouse": "Cháu dâu Nguyễn Thị Trang",
              "image": "images/nguyenthitoan/phamdinhhoang.jpg",
              "phone": "0911119379",
              "address": "Hồ Chí Minh, Việt Nam",
              "description": "Phạm Đình Hoàng 21/08/1991. Nguyễn Thị Trang 05/05/1996",
              "children": [
                {
                  "name": "Chắt gái Phạm An Hoài An",
                  "spouse": "",
                  "image": "images/nguyenthitoan/phamanhoaian.jpg",
                  "phone": "",
                  "address": "Hồ Chí Minh, Việt Nam",
                  "description": ""
                }
              ]
            }
          ]
        }
        // Các thành viên khác...
      ]
    };

    const svg = d3.select("svg"),
      width = +svg.attr("width"),
      height = +svg.attr("height");

    // Thêm định nghĩa clipPath vào SVG
    svg.append("defs")
      .append("clipPath")
        .attr("id", "circleClip")
      .append("circle")
        .attr("r", 25)
        .attr("cx", 0)
        .attr("cy", 0);

    const g = svg.append("g").attr("transform", "translate(40,40)");

    // Tạo đối tượng zoom
    const zoom = d3.zoom()
      .scaleExtent([0.5, 2])
      .on('zoom', (event) => {
        g.attr('transform', event.transform);
      });

    svg.call(zoom);

    // Khởi tạo cây gia phả
    let i = 0;
    const root = d3.hierarchy(treeData, d => d.children);
    root.x0 = height / 2;
    root.y0 = 0;

    // Thu gọn tất cả các node ban đầu
    root.children.forEach(collapse);

    update(root);

    function update(source) {
      const treeLayout = d3.tree().size([height, width]);
      const treeData = treeLayout(root);

      // Cập nhật các nút
      const nodes = treeData.descendants();
      const links = treeData.links();

      // Đặt vị trí cho các nút
      nodes.forEach(d => {
        d.y = d.depth * 180;
      });

      // ------------------- Nodes section -------------------

      // Cập nhật các nút
      const node = g.selectAll('g.node')
        .data(nodes, d => d.id || (d.id = ++i));

      // Enter mới cho các nút
      const nodeEnter = node.enter().append('g')
        .attr('class', 'node')
        .attr('transform', d => `translate(${source.x0},${source.y0})`)
        .on('click', (event, d) => {
          toggle(d);
          update(d);
        })
        .on('mouseover', function(event, d) { showInfo(d, this); })
        .on('mouseout', function(event, d) { hideInfo(d, this); });

      // Thêm hình ảnh cho nút
      nodeEnter.append('image')
        .attr('href', d => d.data.image || 'images/placeholder.jpg')
        .attr('x', -25)
        .attr('y', -25)
        .attr('width', 50)
        .attr('height', 50)
        .attr('clip-path', 'url(#circleClip)')
        .style('cursor', 'pointer')
        .on('click', function(event, d) {
          event.stopPropagation();
          showModal(d);
        });

      // Thêm văn bản cho nút
      nodeEnter.append('text')
        .attr('class', 'info-text')
        .attr('x', 0)
        .attr('y', 35)
        .style('text-anchor', 'middle')
        .text('')
        .style('display', 'none');

      // Thêm nút mở rộng/thu gọn nếu có con
      nodeEnter.filter(d => d.children || d._children).append('circle')
        .attr('class', 'node-button')
        .attr('r', 10)
        .attr('cx', 0)
        .attr('cy', -35)
        .style('fill', d => d._children ? '#555' : '#999')
        .on('click', function(event, d) {
          event.stopPropagation();
          toggle(d);
          update(d);
        });

      nodeEnter.filter(d => d.children || d._children).append('text')
        .attr('class', 'node-button-text')
        .attr('x', 0)
        .attr('y', -31)
        .style('text-anchor', 'middle')
        .style('font-size', '14px')
        .style('fill', 'white')
        .text(d => d._children ? '+' : '-');

      // UPDATE
      const nodeUpdate = nodeEnter.merge(node);

      // Chuyển đến vị trí mới
      nodeUpdate.transition()
        .duration(200)
        .attr('transform', d => `translate(${d.x},${d.y})`);

      // Xóa các nút không còn tồn tại
      const nodeExit = node.exit().transition()
        .duration(200)
        .attr('transform', d => `translate(${source.x},${source.y})`)
        .remove();

      // ------------------- Links section -------------------

      // Cập nhật các liên kết
      const link = g.selectAll('path.link')
        .data(links, d => d.target.id);

      // Enter mới cho các liên kết
      const linkEnter = link.enter().insert('path', "g")
        .attr('class', 'link')
        .attr('d', d => {
          const o = {x: source.x0, y: source.y0};
          return diagonal(o, o);
        });

      // UPDATE
      const linkUpdate = linkEnter.merge(link);

      // Chuyển đến vị trí mới
      linkUpdate.transition()
        .duration(200)
        .attr('d', d => diagonal(d.source, d.target));

      // Xóa các liên kết không còn tồn tại
      const linkExit = link.exit().transition()
        .duration(200)
        .attr('d', d => {
          const o = {x: source.x, y: source.y};
          return diagonal(o, o);
        })
        .remove();

      // Lưu vị trí cũ cho chuyển đổi
      nodes.forEach(d => {
        d.x0 = d.x;
        d.y0 = d.y;
      });
    }

    // Hàm tạo đường liên kết giữa các nút
    function diagonal(s, d) {
      return `M ${s.x} ${s.y}
              C ${(s.x + d.x) / 2} ${s.y},
                ${(s.x + d.x) / 2} ${d.y},
                ${d.x} ${d.y}`;
    }

    // Hàm thu gọn các nút
    function collapse(d) {
      if (d.children) {
        d._children = d.children;
        d._children.forEach(collapse);
        d.children = null;
      }
    }

    // Hàm chuyển đổi trạng thái mở rộng/thu gọn
    function toggle(d) {
      if (d.children) {
        d._children = d.children;
        d.children = null;
      } else {
        d.children = d._children;
        d._children = null;
      }
    }

    // Hàm đặt lại cây về trạng thái ban đầu
    function resetTree() {
      // Thu gọn tất cả các nút
      root.children.forEach(collapse);
      update(root);
    }

    // Hiển thị thông tin khi click vào hình ảnh
    function showModal(d) {
      // Hiển thị thông tin của cha/mẹ
      d3.select('#modalImage')
        .attr('src', d.data.image || 'images/placeholder.jpg');
      d3.select('#modalName').text(d.data.name + (d.data.spouse ? ' & ' + d.data.spouse : ''));
      d3.select('#modalDescription').text(d.data.description || '');
      d3.select('#modalPhone').text(d.data.phone || 'Không có thông tin');
      d3.select('#modalAddress').text(d.data.address || 'Không có thông tin');

      // Xóa nội dung cũ của phần childrenImages
      d3.select('#childrenImages').html('');

      // Kiểm tra nếu người này có con
      if (d.children || d._children) {
        const children = d.children || d._children;

        // Với mỗi con, thêm hình ảnh vào modal
        children.forEach(child => {
          d3.select('#childrenImages')
            .append('img')
            .attr('src', child.data.image || 'images/placeholder.jpg')
            .attr('alt', child.data.name)
            .attr('title', child.data.name)
            .attr('class', 'child-image')
            .on('click', function() {
              // Khi click vào hình ảnh con, hiển thị thông tin của con
              showModal(child);
            });
        });
      } else {
        // Nếu không có con, hiển thị thông báo
        d3.select('#childrenImages')
          .append('p')
          .style('color', '#fff')
          .text('Không có thông tin về con cái.');
      }

      // Hiển thị modal
      d3.select('#imageModal').style('display', 'block');
    }

    // Hiển thị thông tin khi hover
    function showInfo(d, element) {
      const infoText = d3.select(element).select('.info-text');
      infoText.text(`${d.data.name}${d.data.spouse ? ' & ' + d.data.spouse : ''}`)
              .style('display', 'block');
    }

    // Ẩn thông tin khi rời chuột
    function hideInfo(d, element) {
      const infoText = d3.select(element).select('.info-text');
      infoText.style('display', 'none');
    }

    // Sự kiện đóng modal
    d3.select('#closeModal').on('click', function() {
      d3.select('#imageModal').style('display', 'none');
    });

    d3.select('#imageModal').on('click', function(event) {
      if (event.target.id === 'imageModal') {
        d3.select('#imageModal').style('display', 'none');
      }
    });

    // Sự kiện nút zoom
    d3.select('#zoomIn').on('click', () => {
      svg.transition().call(zoom.scaleBy, 1.2);
    });

    d3.select('#zoomOut').on('click', () => {
      svg.transition().call(zoom.scaleBy, 0.8);
    });

    d3.select('#resetZoom').on('click', () => {
      svg.transition().call(zoom.scaleTo, 1);
      svg.transition().call(zoom.translateTo, width / 2, height / 2);
      resetTree(); // Gọi hàm resetTree để đặt lại trạng thái cây
    });

  </script>
</body>
</html>
